<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>centos7开启bbr - 闹市无声</title><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" type="text/css" href="/style.css"></head><body><div class="header"><a href="/"><img src="/logo.png" alt="闹市无声"></a></div><div class="post"><h3>centos7开启bbr</h3><h4>查看内核版本</h4><pre>uname -r</pre><h4>输出类似</h4><pre>3.10.0-514.21.2.el7.x86_64</pre><h4>安装ELRepo仓库</h4><pre>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</pre><h4>安装最新版kernel</h4><pre>yum --enablerepo=elrepo-kernel install kernel-ml -y</pre><h4>确认是否安装成功</h4><pre>rpm -qa | grep kernel</pre><p>如果输出类似如下，包含kernel-ml-5.16.12-1.el7.elrepo.x86_64或更高版本内核，则表示安装成功</p><pre>kernel-3.10.0-693.el7.x86_64
kernel-tools-3.10.0-693.el7.x86_64
kernel-ml-5.16.12-1.el7.elrepo.x86_64
kernel-tools-libs-3.10.0-693.el7.x86_64</pre><h4>设置开机默认启动项，先执行下面代码</h4><pre>egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \'</pre><h4>输出结果类似如下</h4><pre>CentOS Linux 7 Rescue f212d2d7754a4a6bb2b98950c20cc0b5 (5.16.12-1.el7.elrepo.x86_64)
CentOS Linux (5.16.12-1.el7.elrepo.x86_64) 7 (Core)
CentOS Linux (3.10.0-693.el7.x86_64) 7 (Core)
CentOS Linux (0-rescue-d1f142097d497f24c021d7de9b81cab4) 7 (Core)</pre><h4>设置启动项</h4><p>该列表从0开始索引，所以5.16内核索引为1</p><pre>grub2-set-default 1</pre><h4>重启</h4><pre>reboot</pre><h4>查看内核版本</h4><pre>uname -r</pre><h4>如果输出类似</h4><pre>5.16.12-1.el7.elrepo.x86_64</pre><p>则表示升级完成</p><h3>开启bbr</h3><h4>修改sysctl配置</h4><pre>echo 'net.core.default_qdisc=fq' | tee -a /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control=bbr' | tee -a /etc/sysctl.conf
sysctl -p</pre><h4>检查是否加载BBR</h4><pre>lsmod | grep bbr</pre><p>如果输出结果包含tcp_bbr，则表示开启成功</p><pre>tcp_bbr 20480 0</pre><p><br></p></div></body></html>
